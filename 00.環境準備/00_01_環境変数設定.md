# 環境変数設定

``` bash
# スクリプトを再開する場合には、環境変数の再設定に加えて az account set コマンドの実行を忘れないようにする
 
# ログイン処理 (Global Admin + 昇格特権設定でログイン)
az config set extension.use_dynamic_install=yes_without_prompt
az account clear
az login # --tenant ${PRIMARY_DOMAIN_NAME} # --use-device
 
# プライマリドメイン名
PRIMARY_DOMAIN_NAME=XXXXX.onmicrosoft.com
 
# 監視通知先メールアドレス
ALERT_EMAIL_ADDRESS=xxxx@xxxxxxx.com
 
# BCDR 用リージョン
# 0 がメインロケーション（共用リソースは 0 に配置する）
VDC_NUMBERS="0 1"
LOCATION_NAMES[0]=eastus
LOCATION_NAMES[1]=westus
LOCATION_PREFIXS[0]=eus
LOCATION_PREFIXS[1]=wus
 
# IP 帯設計
IP_HUB_PREFIXS[0]="10.0"
IP_HUB_PREFIXS[1]="10.50"
IP_MGMT_PREFIXS[0]="10.48"
IP_MGMT_PREFIXS[1]="10.98"
IP_OPS_PREFIXS[0]="10.49"
IP_OPS_PREFIXS[1]="10.99"
IP_SPOKE_A_PREFIXS[0]="10.1"
IP_SPOKE_A_PREFIXS[1]="10.51"
IP_SPOKE_B_PREFIXS[0]="10.2"
IP_SPOKE_B_PREFIXS[1]="10.52"
 
# サブスクリプションはリージョン別に分離しなくてよい（Firewall Policy などは東西共通）
SUBSCRIPTION_NAME_MGMT=subscription-mgmt
SUBSCRIPTION_NAME_HUB=subscription-hub
SUBSCRIPTION_NAME_SPOKE_A=subscription-spoke-a
SUBSCRIPTION_NAME_SPOKE_B=subscription-spoke-b
 
# グローバル一意識別のための文字列の生成
TEMP=$(echo -n $PRIMARY_DOMAIN_NAME | shasum -a 256)
UNIQUE_SUFFIX=${TEMP:0:5}
 
 
# VM 用管理者名・パスワード
ADMIN_USERNAME=azrefadmin
ADMIN_PASSWORD="p&ssw0rdp&ssw0rd"
 
# 権限分掌（ユーザアカウントの使い分け, Segregation of Duties）をするか否か
# 行う場合は適宜 az login でユーザアカウントを切り替える
FLAG_USE_SOD=true
 
# マルチサブスクリプションで管理グループを使うか否か
FLAG_USE_MG=true
 
# テスト作業の場合は
VDC_NUMBERS=0
 
# SubscriptionID を拾っておく
az account set -s "${SUBSCRIPTION_NAME_MGMT}"
SUBSCRIPTION_ID_MGMT=$(az account show --query id -o tsv)
az account set -s "${SUBSCRIPTION_NAME_HUB}"
SUBSCRIPTION_ID_HUB=$(az account show --query id -o tsv)
az account set -s "${SUBSCRIPTION_NAME_SPOKE_A}"
SUBSCRIPTION_ID_SPOKE_A=$(az account show --query id -o tsv)
az account set -s "${SUBSCRIPTION_NAME_SPOKE_B}"
SUBSCRIPTION_ID_SPOKE_B=$(az account show --query id -o tsv)
 
# 全サブスクリプション ID
# SUBSCRIPTION_IDS=$(az account subscription list --query [].subscriptionId -o tsv)
SUBSCRIPTION_IDS="$SUBSCRIPTION_ID_MGMT $SUBSCRIPTION_ID_HUB $SUBSCRIPTION_ID_SPOKE_A $SUBSCRIPTION_ID_SPOKE_B"
 
# 管理サブスクリプションに切り替え
az account set -s "${SUBSCRIPTION_NAME_MGMT}"

```
